# Приложение кофейни

Данное приложение состоит из трех частей:
1. Backend, написанный на Node.js с использованием `express + sqlite3`
2. Frontend, написанный на `vue.js 3` и библиотеки `antd`
3. CRM, также написанная на `vue.js 3` с библиотекой `antd`

## Порядок запуска
```shell
cd backend
npm install
npm run start

cd frontend
npm install
npm run start

cd crm
npm install
npm run start
```
Для первого запуска нужно зайти в `backend/app.js` и выставить в вызове функций true:
```javascript
await setupTables(db, false); // сюда true, потом снова false
await addDefaultData(db, false); // сюда true, потом снова false
printToConsole(db, false); // сюда true, потом снова false
```
Это простая миграция данных.

## Backend
На бекенде происходят основные вычисления и преобразования данных и создание куки для рефреш токена. 
Выбор пал на `sqlite3` из-за просты и удобства работы с SQL-like базами данных. Код написан в парадигме MVC – 
у каждой сущности в БД есть своя модель и контроллер, который запускает нужный метод во время запроса.

Реализована авторизация и аутентификация по refresh- и access-токенам. 
Рефреш токен живет в безопасной `httpOnly` куке только для страницы `/refresh_token` 15 минут. 
Аксесс токен живет только в оперативной памяти, после обновления страницы обнуляется. Этот токен можно получить как раз 
запросом на страницу `/refresh_token`, там бек проверит наличие и корректность рефреш-токена, и, если все ок,
выдаст аксесс токен, иначе вылетит ошибка 401.

## Frontend
Код фронта написан на vue.js 3 с использованием Composition API. Реализована авторизация, регистрация, работа с токенами,
запросы на бекенд за всей информацией, написаны авто-тесты.
Работа начинается с регистрации: пользователь проходит валидации сначала на стороне фронта, потом на стороне бека.
Если все проверки пройдены, то пользователю отобразится сообщение об успешной регистрации, и возможности авторизоваться.
После логина пользователь получит 2 ключ – аксесс токен, который живет 15 минут, и рефреш-токен, который живет неделю.
При каждой загрузке страницы фронт отправляет запрос на `/refresh_token`, и получает аксесс токен.

На главной странице происходит загрузка всех кафе. У каждого кафе есть название, адрес, фото, меню и тд.
При нажатии на карточку кафе открывается более подробная информация о кафе. Подтягивается его меню, галерея изображений,
и вся остальная информация. В меню отображается изображение, название и цена товара. 

Пока идет загрузка информации, на весь экран крутится лоадер. После получения аксесс токена или загрузки кафе, товаров,
и других элементов, которых нужно ждать с сервера, спиннер закрывается, и отображается контент.
Каждая карточка кафе и товара анимированны – после загрузке они появляются на экране друг за другом.

## CRM
«Админка» приложения, в которой собрана общая информация по бизнесу, а также есть возможность просмотреть статистику 
по каждому отдельному заведению, заказу и покупателю. Графики получают актуальные данные и строятся в реальном времени.
