# Приложение кофейни

Данное приложение состоит из трех частей:
1. Backend, написанный на Node.js с использованием `express + sqlite3`
2. Frontend, написанный на `vue.js 3` и библиотеки `antd`
3. CRM, также написанная на `vue.js 3` с библиотекой `antd`

## Порядок запуска
```shell
cd backend
npm install
npm run start

cd frontend
npm install
npm run start

cd crm
npm install
npm run start
```

В базу данных будут автоматически записаны дефолтные данные, чтобы можно было проверить базовый функционал. 


## Backend
На бекенде происходят основные вычисления и преобразования данных и создание куки для рефреш токена. 
Выбор пал на `sqlite3` из-за просты и удобства работы с SQL-like базами данных. Код написан в парадигме MVC – 
у каждой сущности в БД есть своя модель и контроллер, который запускает нужный метод во время запроса.

Реализована авторизация и аутентификация по refresh- и access-токенам. 
Рефреш токен живет в безопасной `httpOnly` куке только для страницы `/refresh_token` 15 минут. 
Аксесс токен живет только в оперативной памяти, после обновления страницы обнуляется. Этот токен можно получить как раз 
запросом на страницу `/refresh_token`, там бек проверит наличие и корректность рефреш-токена, и, если все ок,
выдаст аксесс токен, иначе вылетит ошибка 401.

## Frontend
Код фронта написан на vue.js 3 с использованием Composition API. Реализована авторизация, регистрация, работа с токенами,
запросы на бекенд за всей информацией, написаны авто-тесты.

### Авторизация и регистрация
Работа начинается с регистрации: пользователь проходит валидации сначала на стороне фронта, потом на стороне бека.
Если все проверки пройдены, то пользователю отобразится сообщение об успешной регистрации, и возможности авторизоваться.
После логина пользователь получит 2 ключ – аксесс токен, который живет 15 минут, и рефреш-токен, который живет неделю.
При каждой загрузке страницы фронт отправляет запрос на `/refresh_token`, и получает аксесс токен.

### Обработка ошибок
Все ответы с бека приходят в следующем формате:
```typescript
interface IResponse {
  ok: Boolean;
  data: any | null;
  message: string[] | null;
};
```

Всегда приходят 3 поля, которые деструктуризируются при получении ответа. Сообщений может быть несколько, например, 
при авторизации или регистрации, поэтому они передаются в формате массива. На фронте все ошибки обрабатываются 
в блоках `try...catch`, поэтому любая шаблонная ошибка с сервера отобразится в виде уведомления.

Данные приходят в соответствии с запросом. Если мы запросили только один элемент, то получим объект, а если мы сделали
запрос за большим количеством данных, то придет уже массив.

Также реализована защита от "упавшего" сервера. При ошибке подключения к серверу, пользователя с любой страницы
перекидывает на `/bad-request`. При обновлении этой страницы будет отправлен запрос на `/refresh-token`, и если сервер
ответил, то дальше уже идет стандартный флоу: если всё ок, переходим на главную, иначе на страницу логина.

### Главная страница
На главной странице происходит загрузка всех кафе. У каждого кафе есть название, адрес, фото, меню и тд.
При нажатии на карточку кафе открывается более подробная информация о кафе. Подтягивается его меню, галерея изображений,
и вся остальная информация. В меню отображается изображение, название и цена товара.
Пока идет загрузка информации, на весь экран крутится лоадер. После получения аксесс токена или загрузки кафе, товаров,
и других элементов, которых нужно ждать с сервера, спиннер закрывается, и отображается контент.
Каждая карточка кафе и товара анимированны – после загрузке они появляются на экране друг за другом.

### Страница кафе
На этой странице отображается полная информация о кафе. Кнопка назад, слайдер с галереей фото, контакты и меню.
Если высота экрана устройства меньше 800, то на месте меню изначально скелет, который исчезает, когда пользователь 
доскроллит до блока с меню, и запустится анимация карточек, а если высота экрана больше, то скелет уже не будет
отображаться. В каждой карточке выводится изображение, название и цена. На карточку можно кликнуть.

### Выбор товара
При нажатии на карточку товара, снизу выезжает экран заказа. Отображается большое изображение товара, его название,
цена, счетчик количества, и все доступные модификаторы: размер, вид молока, сироп и топпинг. У каждого товара свой 
уникальный набор модификаторов, которые приходят с бека. Так, например, у круассана не будет молока.
Во время работы с формой настройки товара можно нажимать включать/выключать модификаторы, и это сразу обновит значение
итоговой цены. Для модификаторов реализованы компоненты, которые рендерят или radio-button, или check-box в зависимости
от поля `multi_selectable` с бека. Каждый компонент рендерит список, собирает данные о включенных элементах, и
передает в основной компонент модификатора используя `emit`.

При нажатии на кнопку формируется товар в корзину, и отправляется соответствующий запрос на бекенд.

## CRM
«Админка» приложения, в которой собрана общая информация по бизнесу, а также есть возможность просмотреть статистику 
по каждому отдельному заведению, заказу и покупателю. Графики получают актуальные данные и строятся в реальном времени.
